---------------------------------------------------------------------------------------------------
-- Authors:
-- Relic
-- Woprock
--
-- Description:
-- Spawns king near default position.
---------------------------------------------------------------------------------------------------

AGS_STARTING_KING_MODULE = "AGS_StartingKing"

---------------------------------------------------------------------------------------------------
-- Delegates:
---------------------------------------------------------------------------------------------------

Core_RegisterModule(AGS_STARTING_KING_MODULE)	

function AGS_StartingKing_UpdateModuleSettings()
	AGS_Print("AGS_StartingKing_UpdateModuleSettings")
	if AGS_GLOBAL_SETTINGS.StartingKings == 0 then
		Core_UnregisterModule(AGS_STARTING_KING_MODULE)
	end
end

function AGS_StartingKing_PresetExecute()
	AGS_Print("AGS_StartingKing_PresetExecute")
	AGS_StartingKing_Create()
end

---------------------------------------------------------------------------------------------------
-- Functions:
---------------------------------------------------------------------------------------------------
-- This function spawns a king next each player's Town Center
function AGS_StartingKing_Create()
	for _, player in pairs(PLAYERS) do		
		local sbp_king = AGS_GetCivilizationUnit(player.raceName, AGS_BP_KING)				
		local snameKNG = AGS_SGroupName(player.id, AGS_BP_KING)		
		local squad_group = SGroup_CreateIfNotFound(snameKNG)	
		--following call is same as original AGS_Starts_GetStartPosition(player.id)
		local spawn_pos = AGS_Scattered_GetScatterPosition() 
		UnitEntry_DeploySquads(player.id, squad_group, {{sbp = sbp_king, numSquads = 1 }}, spawn_pos)
	end
end